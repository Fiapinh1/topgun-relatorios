<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Status Opera√ß√£o - Top Gun</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<style>
  :root {
    --primary: #16a34a;
    --primary-dark: #15803d;
    --primary-light: #dcfce7;
    --border: #e2e8f0;
    --card: #fff;
    --text: #1e293b;
    --muted: #64748b;
    --radius: 12px;
    --shadow: 0 4px 6px rgba(0,0,0,0.1);
  }
  body { background:#f8fafc; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; margin:0; padding:20px; }
  header { display:flex; align-items:center; gap:8px; margin-bottom:20px; }
  header h1 { font-size:1.2rem; color:var(--primary); display:flex; gap:8px; align-items:center; }
  .wrap { max-width:480px; margin:0 auto; display:flex; flex-direction:column; gap:16px; }
  .card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); }
  .card h2 { font-size:16px; color:var(--primary); margin-bottom:12px; display:flex; align-items:center; gap:8px; }
  label { font-size:1rem; color:var(--muted); margin-top:10px; display:block; }
  input, select, textarea {
    width:100%; padding:12px; border:1px solid #1e304b; border-radius:8px;
    font-size:1rem; margin-top:6px;
  }
  .btn {
    padding:14px; border-radius:10px; border:1px solid var(--border);
    font-size:1rem; font-weight:600; cursor:pointer; display:flex; gap:6px; justify-content:center; align-items:center;
  }
  .btn.neon { background:var(--primary); color:#fff; }
  .btn.neon:hover { background:var(--primary-dark); }
  .btn.light { background:var(--primary-light); color:var(--primary-dark); }
  .preview { white-space:pre-wrap; background:#f8fafc; border:1px solid var(--border); border-radius:var(--radius); padding:16px; min-height:200px; font-family:'Courier New', monospace; font-size:1rem; }
  .sep { height:1px; background:var(--border); margin:12px 0; }
</style>
</head>
<body>
<header>
  <a class="btn light" href="./"><i data-lucide="arrow-left"></i> Voltar</a>
  <h1><i data-lucide="activity"></i> Status Opera√ß√£o</h1>
</header>

<div class="wrap">
  <!-- Dados gerais -->
  <section class="card">
    <h2><i data-lucide="list"></i> Dados</h2>
    <label>Data</label>
    <input type="date" id="dtData">

    <label>Frente</label>
    <select id="selFrente">
      <option value="">Selecione‚Ä¶</option>
      <option value="Frente 01">Frente 01</option>
      <option value="Frente 02">Frente 02</option>
    </select>

    <label>Piloto</label>
    <input type="text" id="txtPiloto" readonly placeholder="Autom√°tico">

    <label>OS</label>
    <input type="text" id="txtOS" placeholder="Digite o n√∫mero da OS">
    <button class="btn light" id="btnBuscar"><i data-lucide="search"></i> Buscar</button>

    <label>Fazenda</label>
    <input type="text" id="txtFaz" readonly>

    <label>C√≥digo</label>
    <input type="text" id="txtCod" readonly>

    <label>Hor√°rio</label>
    <input type="text" id="txtHora" readonly>

    <label>Unidade</label>
    <input type="text" id="txtUnidade" readonly>

    <label>Status da Opera√ß√£o</label>
    <select id="selStatus" onchange="toggleObs()">
      <option value="üü† Em andamento">üü† Em andamento</option>
      <option value="üîµ Finalizada">üîµ Finalizada</option>
      <option value="‚ö†Ô∏è Ag. Condi√ß√µes">‚ö†Ô∏è Ag. Condi√ß√µes</option>
    </select>

    <div id="obsBox" style="display:none;">
      <label>Observa√ß√£o</label>
      <textarea id="txtObs"></textarea>
    </div>
  </section>

  <!-- Pr√©via -->
  <section class="card">
    <h2><i data-lucide="eye"></i> Pr√©via WhatsApp</h2>
    <div class="preview" id="preview"></div>
    <div class="sep"></div>
    <button class="btn neon" onclick="gerarPrevia()"><i data-lucide="refresh-cw"></i> Gerar Pr√©via</button>
    <button class="btn" onclick="copiarMsg()"><i data-lucide="copy"></i> Copiar</button>
    <button class="btn light" onclick="abrirWhats()"><i data-lucide="message-circle"></i> Abrir no WhatsApp</button>
  </section>
</div>

<script>
lucide.createIcons();

/* Frente ‚Üí Piloto */
const PILOTOS = { "Frente 01":"Pedro Augusto", "Frente 02":"Maicon Silva" };
document.getElementById("selFrente").addEventListener("change",()=>{
  document.getElementById("txtPiloto").value = PILOTOS[document.getElementById("selFrente").value] || "";
});

/* Data + Hora auto */
document.getElementById("dtData").value = new Date().toISOString().split("T")[0];
document.getElementById("txtHora").value = new Date().toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});

/* Buscar OS (via fetch ao Apps Script) */
const API_URL = "https://script.google.com/macros/s/AKfycbx4JkGENMvPbqdcO2Id0qzRRobj6xrf_hW1FESTsZwktIj734pHsWm7DImvHIynObzCGg/exec"; // troque pelo seu /exec
async function buscarOS(){
  const os = document.getElementById("txtOS").value.trim();
  if(!os){ alert("Digite a OS"); return; }
  const url = `${API_URL}?action=lookup&os=${encodeURIComponent(os)}`;
  const res = await fetch(url);
  const data = await res.json();
  if(data.ok && data.found){
    const it = data.items[0];
    document.getElementById("txtFaz").value = it.fazenda||"";
    document.getElementById("txtCod").value = it.codigo||"";
    document.getElementById("txtUnidade").value = it.unidade||"";
  } else {
    alert("OS n√£o encontrada.");
  }
}
document.getElementById("btnBuscar").addEventListener("click",buscarOS);

/* Mostrar/ocultar observa√ß√£o */
function toggleObs(){
  const val = document.getElementById("selStatus").value;
  document.getElementById("obsBox").style.display = val.includes("Ag. Condi√ß√µes") ? "block" : "none";
}

/* Montar mensagem */
function gerarPrevia(){
  const dt = document.getElementById("dtData").value.split("-").reverse().join("/");
  const fr = document.getElementById("selFrente").value;
  const pi = document.getElementById("txtPiloto").value;
  const os = document.getElementById("txtOS").value;
  const faz= document.getElementById("txtFaz").value;
  const cod= document.getElementById("txtCod").value;
  const hr = document.getElementById("txtHora").value;
  const uni= document.getElementById("txtUnidade").value;
  const st = document.getElementById("selStatus").value;
  const obs= document.getElementById("txtObs").value;

  let msg = `*Status Opera√ß√£o (Cot√©siaü™∞)*\n\n`;
  msg += `*Frente:* ${fr}\n*Piloto:* ${pi}\n*Data:* ${dt}\n*Hor√°rio:* ${hr}\n*OS:* ${os}\n*Faz:* ${faz}\n*C√≥d.:* ${cod}\n*Unidade:* ${uni}\n\n`;
  msg += `*Status da opera√ß√£o:* ${st}`;
  if(st.includes("Ag. Condi√ß√µes") && obs){ msg += `\nObs.: ${obs}`; }
  if(st.includes("Finalizada")){ msg += `\n\n--- OPERA√á√ÉO FINALIZADA ‚úÖ ---`; }

  document.getElementById("preview").textContent = msg;
}

/* Copiar / WhatsApp */
async function copiarMsg(){
  await navigator.clipboard.writeText(document.getElementById("preview").textContent);
  alert("Copiado!");
}
function abrirWhats(){
  const txt = document.getElementById("preview").textContent;
  window.open("https://wa.me/?text="+encodeURIComponent(txt),"_blank");
}
</script>
</body>
</html>
