<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Status de Opera√ß√£o | Top Gun Pulveriza√ß√µes</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Lucide (vers√£o fixa para evitar aviso de sourcemap 404) -->
  <script src="https://unpkg.com/lucide@0.453.0/dist/umd/lucide.js"></script>

  <!-- Fonte Orbitron (t√≠tulo) -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --topgun-green:#16a34a;
      --topgun-green-dark:#15803d;
      --topgun-ink:#1e293b;
      --topgun-dark:#1e304b;
    }
    body{
      background:#f8fafc;
      font-family:'Segoe UI', Arial, sans-serif;
      color:var(--topgun-ink);
    }
    .navbar{ background:var(--topgun-dark); }
    .navbar-brand{ font-family:'Orbitron', sans-serif; letter-spacing:.5px; }
    .btn-topgun{ background:var(--topgun-green); color:#fff; border:none; }
    .btn-topgun:hover{ background:var(--topgun-green-dark); color:#fff; }
    .status-chip{
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.5rem .75rem; border-radius:50rem; font-weight:600;
      border:1px solid rgba(0,0,0,.06); background:#fff;
    }
    .status-ag{ border-color:#facc15; }   /* amarelo */
    .status-em{ border-color:#fb923c; }   /* laranja */
    .status-fi{ border-color:#93c5fd; }   /* azul */
    pre{
      background:#ecfdf5; border-left:4px solid var(--topgun-green);
      padding:1rem; border-radius:8px;
      white-space:pre-wrap; word-wrap:break-word; font-size:1rem;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark shadow-sm">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">
        <i data-lucide="activity" class="me-2"></i> Status de Opera√ß√£o ‚Äî Top Gun Pulveriza√ß√µes
      </span>
    </div>
  </nav>

  <div class="container my-4">

    <!-- Voltar -->
    <button class="btn btn-outline-dark mb-3" onclick="window.location.href='index.html'">
      <i data-lucide="arrow-left" class="me-1"></i> Voltar
    </button>

    <!-- Card principal -->
    <div class="card shadow-sm p-4 mb-4">
      <h4 class="mb-3">
        <i data-lucide="clipboard-check" class="me-2"></i>
        Dados da Opera√ß√£o
      </h4>

      <div class="row g-3">
        <div class="col-sm-3">
          <label class="form-label">Frente</label>
          <select id="frente" class="form-select">
            <option value="">Selecione</option>
            <option>Frente 1</option>
            <option>Frente 2</option>
            <option>Frente 3</option>
            <option>Frente 4</option>
            <option>Frente 5</option>
            <option>Frente 6</option>
            <option>Frente 7</option>
          </select>
        </div>
        <div class="col-sm-3">
          <label class="form-label">Piloto</label>
          <!-- Mant√©m edit√°vel para permitir override -->
          <select id="piloto" class="form-select">
            <option value="">Selecione</option>
            <option>Matheus</option>
            <option>Maicon</option>
            <option>Alexandre</option>
            <option>Felipe</option>
            <option>Luiz Paulo</option>
            <option>Heitor</option>
          </select>
        </div>
        <div class="col-sm-3">
          <label class="form-label">Data</label>
          <input id="data" type="date" class="form-control">
        </div>
        <div class="col-sm-3">
          <label class="form-label">Hor√°rio (auto)</label>
          <input id="hora" type="text" class="form-control" placeholder="--:--:--" readonly>
        </div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-sm-2">
          <label class="form-label">OS</label>
          <input id="os" class="form-control" placeholder="N√∫mero da OS">
        </div>
        <div class="col-sm-2">
          <label class="form-label">C√≥d.</label>
          <input id="cod" class="form-control" placeholder="C√≥digo">
        </div>
        <div class="col-sm-4">
          <label class="form-label">Fazenda</label>
          <input id="faz" class="form-control" placeholder="Nome da fazenda">
        </div>
        <div class="col-sm-4">
          <label class="form-label">Unidade</label>
          <input id="unidade" class="form-control" placeholder="Ex.: Delta - Volta Grande">
        </div>
      </div>

      <div class="mt-3">
        <label class="form-label">Observa√ß√£o (opcional)</label>
        <textarea id="obs" class="form-control" rows="2" placeholder="Adicione observa√ß√µes relevantes..."></textarea>
      </div>

      <hr class="my-4">

      <h6 class="text-muted mb-2"><i data-lucide="traffic-cone" class="me-2"></i>Status da opera√ß√£o</h6>

      <!-- Status: bot√µes r√°pidos -->
      <div class="d-flex flex-wrap gap-2 mb-3">
        <button class="btn btn-outline-warning" onclick="setStatus('AG')">‚ö†Ô∏è Ag. Condi√ß√µes</button>
        <button class="btn btn-outline-warning" style="--bs-btn-color:#f97316; --bs-btn-border-color:#f97316" onclick="setStatus('EM')">üü† Em andamento</button>
        <button class="btn btn-outline-primary" onclick="setStatus('FI')">üîµ Finalizada</button>
      </div>

      <!-- Status selecionado (chip) -->
      <div id="statusChip" class="status-chip status-ag">
        <span id="statusEmoji">‚ö†Ô∏è</span>
        <span id="statusLabel">Ag. Condi√ß√µes</span>
      </div>

      <div class="mt-4 d-grid gap-2 d-sm-flex">
        <button class="btn btn-topgun" onclick="gerarStatus()">
          <i data-lucide="file-text" class="me-1"></i> Gerar Texto
        </button>
        <button class="btn btn-outline-secondary" onclick="limparTudo()">
          <i data-lucide="rotate-ccw" class="me-1"></i> Limpar
        </button>
      </div>
    </div>

    <!-- Sa√≠da -->
    <pre id="saida">Preencha os campos e clique em "Gerar Texto".</pre>

    <button class="btn btn-topgun w-100 mt-2" onclick="copiarSaida()">
      <i data-lucide="copy"></i> Copiar
    </button>

    <!-- Voltar -->
    <button class="btn btn-outline-dark w-100 mt-3" onclick="window.location.href='index.html'">
      <i data-lucide="arrow-left"></i> Voltar √† P√°gina Inicial
    </button>
  </div>

  <!-- Toast -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="toastOk" class="toast text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">
          <i data-lucide="check-circle" class="me-2"></i> Copiado com sucesso!
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= Mapeamento Frente -> Piloto =======
    const MAP_FRENTE_PILOTO = {
      'Frente 1': 'Matheus',
      'Frente 2': 'Maicon',
      'Frente 3': 'Alexandre',
      'Frente 4': 'Felipe',
      'Frente 5': '',            // sem piloto padr√£o
      'Frente 6': 'Luiz Paulo',
      'Frente 7': 'Heitor'
    };

    // Estado do status selecionado
    let STATUS = 'AG'; // AG = Ag. Condi√ß√µes | EM = Em andamento | FI = Finalizada

    // Prefill data de hoje e rel√≥gio autom√°tico
    function prefillDataHoje(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      document.getElementById('data').value = `${yyyy}-${mm}-${dd}`;
    }
    function startClock(){
      setInterval(()=>{
        const d = new Date();
        const hh = String(d.getHours()).padStart(2,'0');
        const mm = String(d.getMinutes()).padStart(2,'0');
        const ss = String(d.getSeconds()).padStart(2,'0');
        document.getElementById('hora').value = `${hh}:${mm}:${ss}`;
      }, 300);
    }

    // Troca visual do status
    function setStatus(code){
      STATUS = code;
      const chip = document.getElementById('statusChip');
      const emoji = document.getElementById('statusEmoji');
      const label = document.getElementById('statusLabel');

      chip.classList.remove('status-ag','status-em','status-fi');

      if(code==='AG'){ emoji.textContent='‚ö†Ô∏è'; label.textContent='Ag. Condi√ß√µes'; chip.classList.add('status-ag'); }
      if(code==='EM'){ emoji.textContent='üü†'; label.textContent='Em andamento'; chip.classList.add('status-em'); }
      if(code==='FI'){ emoji.textContent='üîµ'; label.textContent='Finalizada'; chip.classList.add('status-fi'); }
    }

    // Autopreencher piloto ao selecionar frente
    function handleFrenteChange(){
      const frente = document.getElementById('frente').value;
      const pilotoSelect = document.getElementById('piloto');
      const piloto = MAP_FRENTE_PILOTO[frente] ?? '';
      let found = false;
      Array.from(pilotoSelect.options).forEach(opt=>{
        if(opt.value === piloto && piloto){
          pilotoSelect.value = piloto;
          found = true;
        }
      });
      if(!found){ pilotoSelect.value = ''; } // sem padr√£o ou n√£o encontrado
    }

    // Gera√ß√£o do texto ‚Äî ORDEM NOVA
    function gerarStatus(){
      const unidade = document.getElementById('unidade').value || '';
      const frente = document.getElementById('frente').value || '';
      const piloto = document.getElementById('piloto').value || '';
      const os = document.getElementById('os').value || '';
      const cod = document.getElementById('cod').value || '';
      const faz = document.getElementById('faz').value || '';
      const data = document.getElementById('data').value || '';
      const hora = document.getElementById('hora').value || '';
      const obs = (document.getElementById('obs').value || '').trim();

      // Data BR
      const dataBR = data ? data.split('-').reverse().join('/') : '';

      // Linha de status conforme pedido
      let statusLinha = '';
      if(STATUS==='EM') statusLinha = 'üü† Em andamento';
      else if(STATUS==='FI') statusLinha = 'üîµ Finalizada';
      else statusLinha = '‚ö†Ô∏è Ag. Condi√ß√µes';

      let txt = '';
      txt += `*Status Opera√ß√£o*\n\n`;
      txt += `*Unidade:* ${unidade}\n`;
      txt += `*Frente:* ${frente}\n`;
      txt += `*Piloto:* ${piloto}\n`;
      txt += `_______________\n`;
      txt += `*OS:* ${os}\n`;
      txt += `*C√≥d.:* ${cod}\n`;
      txt += `*Faz:* ${faz}\n`;
      txt += `*Data:* ${dataBR}\n`;
      txt += `*Hor√°rio:* ${hora}\n`;
      if (obs) txt += `\n*Observa√ß√£o:* ${obs}\n`;
      txt += `\n*Status da opera√ß√£o:* ${statusLinha}`;

      document.getElementById('saida').textContent = txt;
    }

    // Copiar
    function copiarSaida(){
      const texto = document.getElementById('saida').textContent;
      navigator.clipboard.writeText(texto).then(()=>{
        const toast = new bootstrap.Toast(document.getElementById('toastOk'));
        toast.show();
      });
    }

    // Limpar
    function limparTudo(){
      ['frente','piloto','os','faz','cod','unidade','obs'].forEach(id=>document.getElementById(id).value='');
      prefillDataHoje(); // mant√©m a data de hoje
      setStatus('AG');   // volta para Ag. Condi√ß√µes
      document.getElementById('saida').textContent = 'Preencha os campos e clique em "Gerar Texto".';
    }

    // Init
    prefillDataHoje(); startClock(); setStatus('AG'); lucide.createIcons();
    document.getElementById('frente').addEventListener('change', handleFrenteChange);
  </script>
</body>
</html>
